# 防御性编程

对项目中的部分代码进行加密，使其在发布后需要通过接口得到的密钥或者临时密钥解密部分代码后才能正常运行。
以此来保证项目只有我在职的时候才能正常运行。

## 原理

- 在开发时，会先从本地启动的 node 服务中直接获取未加密的代码放进项目中，使项目将正常运行
- 在上线后，然后将从服务器获取密钥，对本地加密的代码文件进行解密，然后项目将正常运行
  如果从服务器获取密钥失败，将使用临时密钥对本地加密文件进行解密，然后项目将正常运行(临时密钥有效期一年)

## 如何使用

#### 开发时

在本地 src/tool 文件正常写入需要加密的代码 -> 运行 npm run dev 启动 node 服务 -> 在项目中请求 localhost:1111 拿到未加密的代码(会自动挂载到 window 对象下) -> 项目正常运行

#### 发布时

运行 npm run build -> 在 dist/tool 文件夹中生成加密 src/tool 后的代码 -> 将其放入到项目中的 src 目录下(这就是 项目本地加密文件)

#### 上线后

从接口获取密钥 -> 解密本地加密代码 -> 运行
从接口获取密钥失败 -> 使用临时密钥解密本地加密代码 -> 运行

## 项目结构

index - 接口相关，开发时用于返回未加密的代码 -> 发布后用于返回用于解密的密钥
build - 加密相关，用于加密 src/tool 中的代码，在 dist/tool 生成加密代码文件
key - 密钥相关，填入密钥
src/tool - 未加密内容，需要加密的代码
dist/tool - 已加密内容，加密后的代码

## 命令

npm run dev 启动服务
npm run build 生成代码加密后的文件
